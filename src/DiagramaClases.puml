@startuml Sistema de Gestión de Personal De Investigación - Actualizado

skinparam classAttributeIconSize 0

package "Logica.Entidades" {

    class Jefatura {
        - nombres
        - apellidos
        - correo
        - cedula
        - notificaciones: List<Notificacion>
        + agregarNotificacion(Notificacion): void
        + revisarReportes(): List<Reporte>
        + registrarProyecto(Proyecto): void
        + generarResumenSeguimiento(int): ResumenSeguimiento
        + revisarInformeDeActividades(int): InformeActividades
        + aprobarReporte(Reporte): void
        + actualizarEstadoProyecto(Proyecto, EstadoProyecto): void
        + cargarNotificaciones(): void
    }

    class Director {
        - nombres: String
        - apellidos: String
        - cedula: String
        - correo: String
        - notificaciones: List<Notificacion>
        + agregarParticipacionAReporte(int, int): void
        + iniciarReporte(String, int): int
        + aprobarInformeDeActividades(InformeActividades): void
        + agregarNotificacion(Notificacion): void
        + revisarInformeDeActividades(int): InformeActividades
        + registrarParticipacion(String, LocalDate): void
        + editarReporte(Reporte): void
        + cerrarReporte(Reporte): void
        + enviarReporte(Reporte): void
        + rechazarInformeDeActividades(InformeActividades, String): void
        + registrarPersonalDeInvestigacion(PersonalDeInvestigacion, int, LocalDate): void
        + cargarNotificaciones(): void
    }

    abstract class PersonalDeInvestigacion {
        - informesActividades: List<InformeActividades>
        # notificaciones: List<Notificacion>
        - cedula: String
        - nombres: String
        - correo: String
        - apellidos: String
        - idProyecto: int
        - obtenerProyectoActual(): Proyecto
        + iniciarInformeActividades(): InformeActividades
        + cerrarInformeActividades(InformeActividades): void
        + cargarNotificaciones(): void
        + agregarInforme(InformeActividades): void
        + editarInformeActividades(InformeActividades): void
    }

    abstract class Proyecto {
        - estado: EstadoProyecto
        - director: Director
        - numAsistentesPlanificados: int
        - numAyudantesPlanificados: int
        - codigoProyecto: String
        - duracionMeses: int
        - numTecnicosPlanificados: int
        - personalDeInvestigacion: List<PersonalDeInvestigacion>
        - periodoInicio: PeriodoAcademico
        - idProyecto: int
        - nombre: String
        + agregarPersonal(PersonalDeInvestigacion): void
        + actualizarEstado(): void
    }

    class ProyectoSemilla {
        - tipoProyecto: String
    }

    class ProyectoInterno {
        - tipoProyecto: String
    }

    class Reporte {
        - idProyecto: int
        - periodoAcademico: String
        - participacionesIncluidas: List<Participacion>
        - fechaInicio: LocalDate
        - estado: EstadoReporte
        - fechaCierre: LocalDate
        + agregarParticipacion(Participacion): void
        + estaAtrasado(PeriodoAcademico): boolean
        + cerrarYEnviar(): void
    }

    class PeriodoAcademico {
        - codigo: String
        - fechaInicio: LocalDate
        - fechaFin: LocalDate
        - fechaMitad: LocalDate

    }

    class Participacion {
        - fechaFin: LocalDate
        - estado: EstadoParticipacion
        - motivoRetiro: String
        - fechaInicio: LocalDate
        - fechaRetiro: LocalDate
        - personal: PersonalDeInvestigacion
        - idParticipacion: int
        + registrarRetiro(String): void
        + calcularDuracionDias(): long
        + esFinalizado(): boolean
        + esRetirado(): boolean
        + esActivo(): boolean
    }

    class InformeActividades {
        - estado: EstadoInforme
        - personalDeInvestigacion: PersonalDeInvestigacion
        - fechaRegistro: LocalDate
        - idInforme: int
        - proyecto: Proyecto
        - semanas: List<SemanaActividades>
        + enviarParaRevision(): void
        + devolverParaEdicion(): void
        + rechazar(String): void
        + aprobar(): void
        + calcularHorasTotales(): double
        + agregarSemana(SemanaActividades): void
    }

    class ResumenSeguimiento {
        - cantidadAsistentesRegistrados: int
        - cantidadTecnicosRetirados: int
        - totalPlanificado: int
        - cantidadAyudantesPlanificados: int
        - cantidadAsistentesPlanificados: int
        - cantidadAyudantesRegistrados: int
        - cantidadTecnicosRegistrados: int
        - cumplePlanificacionGlobal: boolean
        - cantidadAsistentesRetirados: int
        - cantidadAyudantesActivos: int
        - cantidadTecnicosPlanificados: int
        - cantidadTecnicosActivos: int
        - cantidadAyudantesRetirados: int
        - cantidadAsistentesActivos: int
        - totalRegistrado: int
        + isCumplePlanificacionGlobal(): boolean
        + verificarCumplimiento(): boolean
        + calcularTotales(): void
    }

    class Notificacion {
        - fecha: LocalDateTime
        - idUsuario: int
        - contenido: String
        - idNotificacion: int
    }

    class SemanaActividades {
      - horasSalida: Time[]
      - id: int
      - numeroSemana: int
      - observaciones: String
      - actividadSemanal: String
      - horasInicio: Time[]
      - fechas: Date[]
      + contarDiasTrabajados(): int
      + calcularHorasTotales(): double
    }

    class Asistente {}

    class Ayudante {}

    class Tecnico {}

    enum EstadoProyecto {
        EN_REVISION
        APROBADO
        NO_APROBADO
        FINALIZADO
    }

    enum EstadoReporte {
        EN_EDICION
        CERRADO
        APROBADO
    }

    enum EstadoParticipacion {
        ACTIVO
        RETIRADO
        FINALIZADO
    }



}

' ============================================
' RELACIONES ENTRE ENTIDADES
' ============================================

' Proyecto y Director
Director --> Proyecto
Proyecto --> PeriodoAcademico

' Herencia Proyectos
ProyectoInterno --|> Proyecto
ProyectoSemilla --|> Proyecto

' Reporte
Proyecto --> Reporte
Reporte --> PeriodoAcademico
Reporte --> EstadoReporte
Reporte --> Participacion

' Resumen
Proyecto --> ResumenSeguimiento

' [NUEVO] Relacion Participacion -> Informe
' Una Participacion tiene muchos informes de actividades
PersonalDeInvestigacion --> InformeActividades
InformeActividades --> EstadoReporte

' Personal y Participacion
PersonalDeInvestigacion --> Participacion
Participacion --> EstadoParticipacion

' Director gestiona Personal
Director --> PersonalDeInvestigacion
Director ..> InformeActividades

' Herencia Personal
Ayudante --|> PersonalDeInvestigacion
Tecnico --|> PersonalDeInvestigacion
Asistente --|> PersonalDeInvestigacion

' Jefatura y Notificaciones
Notificacion <-- Director
Jefatura --> Proyecto
Jefatura --> Notificacion
' Jefatura revisa informes
Proyecto --> EstadoProyecto
PersonalDeInvestigacion --> Proyecto

InformeActividades --> SemanaActividades

@enduml